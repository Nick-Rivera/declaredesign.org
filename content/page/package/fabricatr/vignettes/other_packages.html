---
title: "Using other data generating packages with **fabricatr**"
author: "Aaron Rudkin"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using other data generating packages with **fabricatr**}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



<p>In general, <strong>fabricatr</strong> is going to be compatible with any existing packages you use to generate synthetic data in one of two ways: either using those packages to create variables within a <code>fabricate</code> call, or using those packages to make complete data frames which are then imported into a <code>fabricate</code>. Below we provide examples for some of the most popular packages that serve this purpose. Please feel free to <a href="Contact%20Us">http://discuss.declaredesign.org/</a> if you have any questions about using another package in concert with <strong>fabricatr</strong>.</p>
<div id="wakefield-simulating-common-demographic-features" class="section level2">
<h2><strong>wakefield</strong>: simulating common demographic features</h2>
<p><strong>wakefield</strong> (by <a href="https://github.com/trinker">Tyler Rinker</a>) is a popular <code>R</code> package for creating synthetic data. <strong>wakefield</strong>’s strength is that it can quickly generate common variables, especially for human demographic features. <strong>wakefield</strong> can easily be integrated into a <strong>fabricatr</strong> workflow in one of two ways: using <strong>wakefield</strong> to create individual variables within a <code>fabricate</code> call, or using <strong>wakefield</strong> to make a data frame and importing that data frame into a <code>fabricate</code> call.</p>
<p>In this example, we create a data-set of participants in a survey experiment, using <strong>wakefield</strong> to generate the demographic variables</p>
<pre class="r"><code>library(wakefield)

survey_experiment_df &lt;- fabricate(
  N = 50,
  treatment = draw_binary(prob = 0.5, N = N),
  age = age(n = N),
  race = race(n = N),
  sex = sex(n = N),
)</code></pre>
<p>Researchers interested in learning about <strong>wakefield</strong>’s available functionality, parameterizations, and default probability can <a href="https://github.com/trinker/wakefield">read <strong>wakefield</strong>’s user guide on GitHub</a>.</p>
<p>In addition to creating variables within a <code>fabricate</code> call, users can import completed <strong>wakefield</strong> data frames into a <code>fabricate</code> call:</p>
<pre class="r"><code>survey_experiment_df &lt;- r_data_frame(
  n = 50,
  age,
  race,
  sex)

fabricatr_df &lt;- fabricate(
  data = survey_experiment_df,
  treatment = draw_binary(prob = 0.5, N = N)
)</code></pre>
</div>
<div id="randomnames-plausible-names-for-human-subjects" class="section level2">
<h2><strong>randomNames</strong>: Plausible names for human subjects</h2>
<p><strong>randomNames</strong> (by <a href="https://github.com/dbetebenner">Damian Betebenner</a>) is a package that does one thing well: generate random names for human subjects (including with specified genders and ethnicities). The primary use case would be to use this as part of generating a variable within a <code>fabricate</code> call. In the below example, we use <code>fabricate</code> to generate some other demographic data, and then <code>randomNames</code> to generate matching names.</p>
<pre class="r"><code>library(randomNames)

experiment_data &lt;- fabricate(
  N = 50,
  treatment = draw_binary(prob = 0.5, N = N),
  is_female = draw_binary(prob = 0.5, N = N),
  patient_name = randomNames(N, gender=is_female)
)</code></pre>
<p>Note that we make use of the existing <code>is_female</code> variable from the <code>fabricate</code> call to ensure <code>randomNames</code> generates gender-typical names.</p>
</div>
<div id="modeling-causality-with-dags-and-simcausal" class="section level2">
<h2>Modeling causality with DAGs and <strong>simcausal</strong></h2>
<p>Users who are familiar with the DAGS (directed acyclic graphs) model of causal inference may have interest in using the <strong>simcausal</strong> package, which allows users to specify a DAGS model and then sample from it. Integrating this package with <strong>fabricatr</strong> is likely to involve using <strong>simcausal</strong> first to specify a model, simulating data from the model, and then importing data into a <code>fabricate</code> call for further user with <strong>fabricatr</strong>.</p>
<p>Consider this example, common in the literature on educational attainment and school outcomes, where students come from families that have a <code>wealth</code> parameter, assignment to schools is based partially on <code>wealth</code>, and test outcomes (<code>testoutcome</code>) is based on both school quality and wealth.</p>
<pre class="r"><code>library(&quot;simcausal&quot;)

# Define DAG
D &lt;- DAG.empty() + 
  node(&quot;wealth&quot;, distr = &quot;rnorm&quot;,
       mean = 30000,
       sd = 10000) +
  node(&quot;schoolquality&quot;, distr = &quot;runif&quot;,
       min = 0 + (5 * (wealth &gt; 50000)),
       max = 10) +
  node(&quot;testoutcome&quot;, distr = &quot;runif&quot;,
       min = 0 + 0.0001 * wealth + 0.25 * schoolquality,
       max = 10)

# Freeze DAG object
set_dag &lt;- set.DAG(D)

# Draw data from DAG
df &lt;- sim(set_dag, n = 100)

# Pass into fabricate call and make new variables as necessary
fabricate(df,
          passed_test = testoutcome &gt; 6,
          eligible_for_snap = wealth &lt; 25000)</code></pre>
</div>
<div id="survival-and-duration-models-with-simsurv" class="section level2">
<h2>Survival and duration models with <strong>simsurv</strong></h2>
<p><strong>simsurv</strong> is a package dedicated to generating panel survival data. The most likely way you might integrate <strong>simsurv</strong> with <strong>fabricatr</strong> would be to use <strong>fabricatr</strong> to generating covariates which can then be imported into <strong>simsurv</strong> to model in a hazard or duration context.</p>
<p>Here, our example will be a clinical trial of a cancer drug. Participants have the expected biographical data: age, gender, whether the patient smokes, the disease stage, assignment to treatment, and a KPS score (commonly used to evaluate overall patient health).</p>
<p>Survival data creates a ragged longitudinal survey; some patients will die during the course of the trial, removing them as observations. Others will continue alive until the end of the trial. We specify a “hazard function”, which tells <strong>simsurv</strong> how the course of patient survival will change over time. Covariates with positive <code>betas</code> increase risk of death, while covariates with negative <code>betas</code> decrease risk of death. We will track patients for 5 years after treatment.</p>
<pre class="r"><code>library(simsurv)

# Simulate patient data in a clinical trial
participant_data &lt;- fabricate(
  N = 100,
  age = runif(N, min = 18, max = 85),
  is_female = draw_binary(prob = 0.5, N = N),
  is_smoker = draw_binary(prob = 0.2 + 0.2 * (age &gt; 50), N = N),
  disease_stage = round(runif(N, min = 1 + 0.5 * (age &gt; 65), max = 4)),
  treatment = draw_binary(prob = 0.5, N = N),
  kps = runif(N, min = 40, max = 100)
)

# Simulate data in the survival context
survival_data &lt;- simsurv(
  lambdas = 0.1, gammas = 0.5,
  x = participant_data, 
  betas = c(is_female = -0.2, is_smoker = 1.2,
            treatment = -0.4, kps = -0.005,
            disease_stage = 0.2),
  maxt = 5)</code></pre>
<p>The generated data from the <code>survival_data</code> object can then be re-imported into the <code>participant_data</code> using any data merging tools, including through a <code>fabricate</code> call, and then used for subsequent analyses (e.g. using the <strong>survival</strong> package).</p>
</div>
<div id="time-series-using-forecast" class="section level2">
<h2>Time series using <strong>forecast</strong></h2>
<p><strong>forecast</strong>, by <a href="https://github.com/robjhyndman/forecast">Rob Hyndman</a>, is a package commonly used to analyze time series data which also has functionality capable of generating simulated time series data. <strong>forecast</strong> can use the <code>Arima</code> and <code>simulate</code> functions to create pre-specified ARIMA models, including seasonal time trends.</p>
<p>Below, we provide an example of using <strong>forecast</strong> to generate an ARIMA time series, reshape the data, and import it into <strong>fabricatr</strong> to create new variables of interest.</p>
<pre class="r"><code>library(forecast)

arima_model &lt;- simulate(
  Arima(ts(rnorm(100), frequency = 4),
        order = c(1, 0, 1))
  
fabricate(data.frame(arima_model), 
          year = rep(1:25, each=4),
          quarter = rep(1:4, 25))</code></pre>
<p>Here, <code>ts</code> converts a series of data into a time series, with frequency specifying the number of observations per unit of time (in this case, for example, quarters in a year). <code>Arima</code> ingests this data and fits an ARIMA model with the specified parameters. <code>simulate</code> draws new data from the fit time series, producing a vector of interest. We then import the data into a <code>fabricate</code> call (converting it to a data frame) and add new columns of interest.</p>
</div>
<div id="other-data-simulation-tools" class="section level2">
<h2>Other data simulation tools</h2>
<p>The <code>R</code> ecosystem has many other data simulation tools, and all can be used to complement or supplement <strong>fabricatr</strong> in your workflow. Some of the packages that we have noticed but not covered here include:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/gems/index.html">gems</a> by Luisa Salazar Vizcaya</li>
<li><a href="https://cran.r-project.org/web/packages/simFrame/index.html">simFrame</a> by Andreas Alfons</li>
<li><a href="https://cran.r-project.org/web/packages/simPop/index.html">simPop</a> by Matthias Templ</li>
<li><a href="https://cran.r-project.org/web/packages/simstudy/index.html">simStudy</a> by Keith Goldfeld</li>
<li><a href="https://cran.r-project.org/web/packages/synthpop/index.html">synthPop</a> by Beata Nowok</li>
</ul>
<p>If you’d like to see a tutorial on using these packages or any others with <strong>fabricatr</strong>, please <a href="http://discuss.declaredesign.org/">Contact Us</a> so we can help you</p>
</div>
