---
title: "Advanced features"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Advanced features}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



<div id="quick-design" class="section level1">
<h1>Quick design</h1>
<p>You can also write a design maker function that declares a design based on a set of parameters like <code>N</code>, the number of clusters, etc. and use the function <code>fill_out()</code> to make designs using just those parameters.</p>
<pre class="r"><code>m_arm_trial &lt;- function(numb){
  my_population &lt;- declare_population(
    N = numb, income = rnorm(N), age = sample(18:95, N, replace = T))

  my_potential_outcomes &lt;- declare_potential_outcomes(
    formula = Y ~ .25 * Z + .01 * age * Z)
  my_sampling &lt;- declare_sampling(n = 250)
  my_assignment &lt;- declare_assignment(m = 25)
  my_estimand &lt;- declare_estimand(ATE = mean(Y_Z_1 - Y_Z_0))
  my_estimator_dim &lt;- declare_estimator(Y ~ Z, estimand = my_estimand)
  my_design &lt;- declare_design(my_population,
                              my_potential_outcomes,
                              my_estimand,
                              my_sampling,
                              my_assignment,
                              reveal_outcomes,
                              my_estimator_dim)
  return(my_design)
}

my_1000_design &lt;- fill_out(template = m_arm_trial, numb = 1000)
head(draw_data(my_1000_design))</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">ID</th>
<th align="right">income</th>
<th align="right">age</th>
<th align="right">Y_Z_0</th>
<th align="right">Y_Z_1</th>
<th align="right">S_inclusion_prob</th>
<th align="right">Z</th>
<th align="right">Z_cond_prob</th>
<th align="right">Y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6</td>
<td align="left">0006</td>
<td align="right">-0.91</td>
<td align="right">51</td>
<td align="right">0</td>
<td align="right">0.76</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>9</td>
<td align="left">0009</td>
<td align="right">0.86</td>
<td align="right">40</td>
<td align="right">0</td>
<td align="right">0.65</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>10</td>
<td align="left">0010</td>
<td align="right">-0.10</td>
<td align="right">75</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>19</td>
<td align="left">0019</td>
<td align="right">0.69</td>
<td align="right">21</td>
<td align="right">0</td>
<td align="right">0.46</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>22</td>
<td align="left">0022</td>
<td align="right">-0.05</td>
<td align="right">55</td>
<td align="right">0</td>
<td align="right">0.80</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>26</td>
<td align="left">0026</td>
<td align="right">-1.38</td>
<td align="right">51</td>
<td align="right">0</td>
<td align="right">0.76</td>
<td align="right">0.25</td>
<td align="right">0</td>
<td align="right">0.9</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="continuous-potential-outcomes" class="section level1">
<h1>Continuous potential outcomes</h1>
<pre class="r"><code>my_potential_outcomes_continuous &lt;- declare_potential_outcomes(
  formula = Y ~ .25 * Z + .01 * age * Z, conditions = seq(0, 1, by = .1))

continuous_treatment_function &lt;- function(data){
 data$Z &lt;- sample(seq(0, 1, by = .1), size = nrow(data), replace = TRUE)
 data
}

my_assignment_continuous &lt;- declare_assignment(handler = continuous_treatment_function)

my_design &lt;- declare_design(my_population(),
                            my_potential_outcomes_continuous,
                            my_assignment_continuous,
                            reveal_outcomes)

head(draw_data(my_design))</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">ID</th>
<th align="right">income</th>
<th align="right">age</th>
<th align="right">Y_Z_0</th>
<th align="right">Y_Z_0.1</th>
<th align="right">Y_Z_0.2</th>
<th align="right">Y_Z_0.3</th>
<th align="right">Y_Z_0.4</th>
<th align="right">Y_Z_0.5</th>
<th align="right">Y_Z_0.6</th>
<th align="right">Y_Z_0.7</th>
<th align="right">Y_Z_0.8</th>
<th align="right">Y_Z_0.9</th>
<th align="right">Y_Z_1</th>
<th align="right">Z</th>
<th align="right">Y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">-0.38</td>
<td align="right">73</td>
<td align="right">0</td>
<td align="right">0.10</td>
<td align="right">0.20</td>
<td align="right">0.29</td>
<td align="right">0.39</td>
<td align="right">0.49</td>
<td align="right">0.59</td>
<td align="right">0.69</td>
<td align="right">0.78</td>
<td align="right">0.88</td>
<td align="right">0.98</td>
<td align="right">0.3</td>
<td align="right">0.29</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">-0.80</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">0.06</td>
<td align="right">0.12</td>
<td align="right">0.18</td>
<td align="right">0.24</td>
<td align="right">0.30</td>
<td align="right">0.37</td>
<td align="right">0.43</td>
<td align="right">0.49</td>
<td align="right">0.55</td>
<td align="right">0.61</td>
<td align="right">0.3</td>
<td align="right">0.18</td>
</tr>
<tr class="odd">
<td align="left">0003</td>
<td align="right">1.54</td>
<td align="right">26</td>
<td align="right">0</td>
<td align="right">0.05</td>
<td align="right">0.10</td>
<td align="right">0.15</td>
<td align="right">0.20</td>
<td align="right">0.26</td>
<td align="right">0.31</td>
<td align="right">0.36</td>
<td align="right">0.41</td>
<td align="right">0.46</td>
<td align="right">0.51</td>
<td align="right">0.0</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">0004</td>
<td align="right">-0.77</td>
<td align="right">19</td>
<td align="right">0</td>
<td align="right">0.04</td>
<td align="right">0.09</td>
<td align="right">0.13</td>
<td align="right">0.18</td>
<td align="right">0.22</td>
<td align="right">0.26</td>
<td align="right">0.31</td>
<td align="right">0.35</td>
<td align="right">0.40</td>
<td align="right">0.44</td>
<td align="right">0.5</td>
<td align="right">0.22</td>
</tr>
<tr class="odd">
<td align="left">0005</td>
<td align="right">-0.07</td>
<td align="right">50</td>
<td align="right">0</td>
<td align="right">0.08</td>
<td align="right">0.15</td>
<td align="right">0.23</td>
<td align="right">0.30</td>
<td align="right">0.38</td>
<td align="right">0.45</td>
<td align="right">0.52</td>
<td align="right">0.60</td>
<td align="right">0.68</td>
<td align="right">0.75</td>
<td align="right">0.5</td>
<td align="right">0.38</td>
</tr>
<tr class="even">
<td align="left">0006</td>
<td align="right">-1.12</td>
<td align="right">56</td>
<td align="right">0</td>
<td align="right">0.08</td>
<td align="right">0.16</td>
<td align="right">0.24</td>
<td align="right">0.32</td>
<td align="right">0.40</td>
<td align="right">0.49</td>
<td align="right">0.57</td>
<td align="right">0.65</td>
<td align="right">0.73</td>
<td align="right">0.81</td>
<td align="right">0.5</td>
<td align="right">0.40</td>
</tr>
</tbody>
</table>
</div>
<div id="attrition" class="section level1">
<h1>Attrition</h1>
<p>Attrition can be thought of as just another potential outcome. That is, one describe possible attrition processes, include them in the design, and see how estimation strategies are affected by these processes. Here is an example.</p>
<pre class="r"><code>my_potential_outcomes_attrition &lt;- declare_potential_outcomes(
  formula = R ~ rbinom(n = N, size = 1, prob = pnorm(Y_Z_0)))

my_design &lt;- declare_design(my_population(),
                            my_potential_outcomes,
                            my_potential_outcomes_attrition,
                            my_assignment,
                            reveal_outcomes(outcome_variables = &quot;R&quot;),
                            reveal_outcomes(attrition_variables = &quot;R&quot;))

head(draw_data(my_design)[, c(&quot;ID&quot;, &quot;Y_Z_0&quot;, &quot;Y_Z_1&quot;, &quot;R_Z_0&quot;, &quot;R_Z_1&quot;, &quot;Z&quot;, &quot;R&quot;, &quot;Y&quot;)])</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">ID</th>
<th align="right">Y_Z_0</th>
<th align="right">Y_Z_1</th>
<th align="right">R_Z_0</th>
<th align="right">R_Z_1</th>
<th align="right">Z</th>
<th align="right">R</th>
<th align="right">Y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0001</td>
<td align="right">0</td>
<td align="right">1.13</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0002</td>
<td align="right">0</td>
<td align="right">1.04</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">0003</td>
<td align="right">0</td>
<td align="right">0.90</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">0004</td>
<td align="right">0</td>
<td align="right">1.14</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">0005</td>
<td align="right">0</td>
<td align="right">0.73</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">0006</td>
<td align="right">0</td>
<td align="right">1.16</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div id="stochastic-population-sizes" class="section level1">
<h1>Stochastic population sizes</h1>
<p>The population (or any level of the population) can have stochastic population sizes. (In fact, N can be a number, a fixed vector of numbers, or an expression that returns a stochastic number or vector of numbers.)</p>
<pre class="r"><code>stochastic_population &lt;- declare_population(
  N = sample(500:1000, 1), income = rnorm(N), age = sample(18:95, N, replace = TRUE))

c(nrow(stochastic_population()), 
  nrow(stochastic_population()), 
  nrow(stochastic_population()))</code></pre>
<p>880, 640, 764</p>
</div>
