---
title: "Resampling data with fabricatr"
author: "Aaron Rudkin"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Resampling data with fabricatr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



<p>One way to imagine new data is to take data you already have and resample it, ensuring that existing inter-correlations between variables are preserved, while generating new data or expanding the size of the dataset. <strong>fabricatr</strong> offers several options to simulate resampling.</p>
<div id="bootstrapping" class="section level1">
<h1>Bootstrapping</h1>
<p>The simplest option in <strong>fabricatr</strong> is to “bootstrap” data. Taking data with N observations, the “bootstrap” resamples these observations with replacement and generates N new observations. Existing observations may be used zero times, once, or more than once. Bootstrapping is very simple with the <code>resample_data()</code> function:</p>
<pre class="r"><code>survey_data &lt;- fabricate(N = 10, voted_republican = draw_binary(prob = 0.5, N = N))

survey_data_new &lt;- resample_data(survey_data)
head(survey_data_new)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">ID</th>
<th align="right">voted_republican</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">02</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">08</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">07</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">08</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">06</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">05</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>It is also possible to resample fewer or greater number of observations from your existing data. We can do this by specifying the argument <code>N</code> to <code>resample_data()</code>. Consider expanding a small dataset to allow for better imagination of larger data to be collected later.</p>
<pre class="r"><code>large_survey_data &lt;- resample_data(survey_data, N = 100)
nrow(large_survey_data)</code></pre>
<p>100</p>
</div>
<div id="resampling-hierarchical-data" class="section level1">
<h1>Resampling hierarchical data</h1>
<p>One of the most powerful features of all of <strong>fabricatr</strong> is the ability to resample from hierarchical data at any or all levels. Doing so requires specifying which levels you will want to resample with the <code>ID_labels</code> argument. Unless otherwise specified, all units from levels below the resampled level will be kept. In our earlier country-province-citizen dataset, resampling countries will lead to all provinces and citizens of the selected country being carried forward. You can resample at multiple levels simultaneously.</p>
<p>Consider this example, which takes a dataset containing 2 cities of 3 citizens, and resamples it into a dataset of 3 cities, each containing 5 citizens.</p>
<pre class="r"><code>my_data &lt;-
  fabricate(
    cities = add_level(N = 2, elevation = runif(n = N, min = 1000, max = 2000)),
    citizens = add_level(N = 3, age = runif(N, 18, 70))
  )

my_data_2 &lt;- resample_data(my_data, N = c(3, 5), ID_labels = c(&quot;cities&quot;, &quot;citizens&quot;))
head(my_data_2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">cities</th>
<th align="right">elevation</th>
<th align="left">citizens</th>
<th align="right">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2</td>
<td align="right">1971</td>
<td align="left">4</td>
<td align="right">44</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">1971</td>
<td align="left">6</td>
<td align="right">45</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">1971</td>
<td align="left">6</td>
<td align="right">45</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">1971</td>
<td align="left">5</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">1971</td>
<td align="left">4</td>
<td align="right">44</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">1493</td>
<td align="left">3</td>
<td align="right">26</td>
</tr>
</tbody>
</table>
<p><code>resample_data()</code> will first select the cities to be resampled. Then, for each city, it will continue by selecting the citizens to be resampled. If a higher level unit is used more than once (for example, the same city being chosen twice), and a lower level is subsequently resampled, the choices of which units to keep for the lower level will differ for each copy of the higher level. In this example, if city 1 is chosen twice, then the sets of five citizens chosen for each copy of the city 1 will differ.</p>
<p>You can also specify the levels you wish to resample from using the name arguents to the <code>N</code> parameter, like in this example which does exactly the same thing as the previous example, but specifies the level names in a different way:</p>
<pre class="r"><code>my_data &lt;-
  fabricate(
    cities = add_level(N = 2, elevation = runif(n = N, min = 1000, max = 2000)),
    citizens = add_level(N = 3, age = runif(N, 18, 70))
  )

my_data_2 &lt;- resample_data(my_data, N = c(cities = 3, citizens = 5))
head(my_data_2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">cities</th>
<th align="right">elevation</th>
<th align="left">citizens</th>
<th align="right">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2</td>
<td align="right">1014</td>
<td align="left">6</td>
<td align="right">39</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">1014</td>
<td align="left">5</td>
<td align="right">51</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">1014</td>
<td align="left">5</td>
<td align="right">51</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">1014</td>
<td align="left">6</td>
<td align="right">39</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="right">1014</td>
<td align="left">5</td>
<td align="right">51</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">1014</td>
<td align="left">4</td>
<td align="right">41</td>
</tr>
</tbody>
</table>
</div>
<div id="passthrough-resampling" class="section level1">
<h1>“Passthrough” Resampling</h1>
<p>In some cases it may make sense to resample each unit at a given level. For example, there may be value in resampling 1 citizen in each and every city represented in the data set. <strong>fabricatr</strong> allows the user to specify <code>ALL</code> for the <code>N</code> argument to a given level to accomplish this:</p>
<pre class="r"><code>my_data &lt;-
  fabricate(
    cities = add_level(N = 2, elevation = runif(n = N, min = 1000, max = 2000)),
    citizens = add_level(N = 3, age = runif(N, 18, 70))
  )

my_data_3 &lt;- resample_data(my_data, N = c(ALL, 1), ID_labels = c(&quot;cities&quot;, &quot;citizens&quot;))
head(my_data_3)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">cities</th>
<th align="right">elevation</th>
<th align="left">citizens</th>
<th align="right">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">1122</td>
<td align="left">1</td>
<td align="right">39</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">1438</td>
<td align="left">6</td>
<td align="right">23</td>
</tr>
</tbody>
</table>
</div>
